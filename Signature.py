from base64 import encode
from Crypto.PublicKey import RSA
from Crypto.Signature.pkcs1_15 import PKCS115_SigScheme
from Crypto.Hash import SHA256
import binascii
from base64 import b64encode,b64decode

class Signature:
    def __init__(self,n,e,d):
        self.rsaKey=RSA.construct((int(n), int(e), int(d)))
        self.pubKey=self.rsaKey.publickey()

    def Signaturing(self,msg):
        hash = SHA256.new(bytes(str(msg),encoding='utf-8'))
        signer = PKCS115_SigScheme(self.rsaKey)
        return signer.sign(hash)


class Verifyer:
    def __init__(self,n,e):
        self.rsaKey=RSA.construct((int(n), int(e) ))
        self.pubKey=self.rsaKey.publickey()

    def Verify(self,wantVerifyMsg,msg):

        hash = SHA256.new(bytes(str(msg),encoding='utf-8'))
        verifier = PKCS115_SigScheme(self.pubKey)
        
        try:
            verifier.verify(hash, wantVerifyMsg)
            return True
        except Exception as e:
            print(e)
            return False

n = 503591335186393219362889058875513766185804175254109841161520658964614292349823588540946661286490466767854226576389672711627538641038240551013036239537643245460385619223907071388933454208741389530272784408731696885658361131973085790842971472241866141893503848051609861423936927929796982988569969641192672566077365607387225816042626482830407708080840651910911102998057739363283671979542950045317602257245310357511498769813886945677383901580035019803766408962137072770801034427475510071758106668830305030369075578330623931003348776294513185618757699750172885454949220251388412918312683870681600997384775911908019360587549355183608433892936411728518021528430915893695482341852653328668011806434443245813034454967487331193332859674791464004099179380337453821070497699052531619292036159071161101399309502823943099773571025949598025010571431170804601042469961517718074313051028428826250832213371937152286374050391585340065519048565313368370590769269640605796050204466797878006129324023839830461892279420173644609013197921073059997351097022586541424071212128971998473820078654222151966945371876853900649439428581505761232322013742127825541317660750535378446809580887728809048408442330988755578068116967245356124202944034643627256091431825631
e = 65537
d = 93868681060118399800678284682290555987087962599816986124313538457844091053076047997561750069056678548546732866276702348982132414344921900165940624413565617689916699336851683538874392734088908776749200212659511560724515000506327967727203556844326667216550086329836063096492264088841416973440510690706161222930575068432219213097589531322096839371889915677307323103350372218164904357875653108222833348711547848198124249996894012975798735701995938201669445532774867341625424364344428811764301555860521632833187775834824632515020654763168486130258389309063765029184425203945265303723205916722560351924140905745889566335610942303995049878868019564179107959345473053725635477411088412973143037067892554996728075382828125096881057263677670649080443322002822118051741459433942888054572153644329884031865485085429085952097296893224635208362332939761348943760566436894660963845689545577322503301521960862330213067135350883491592505058171588658087955230113986637359825590483846075167395201665151196297138666511026814255719797319956027996808171353117237335442184603682296088236467434490683021003180891192534562022328682791333121553950263381197608030074859736514624474716651829096590721435581076983366868360348866088313411821295340252039666477825

mySignature = Signature(n,e,d)
signMsg = mySignature.Signaturing("klavyefl@gmail.com")
print("tipi signMsg  ",type(signMsg))


myVerifyer = Verifyer(n,e)

print(myVerifyer.Verify(signMsg,"klavyefl@gmail.com"))

# if signMsg == bytes(signature[2:-1:],encoding="utf-8"):
#     print("Burada")


# mySignature = Signature(n,e,d)

# signMsg = mySignature.Signaturing("klavyefl@gmail.com")

# #print("i[FromSignature] ",i["FromSignature"], len(i["FromSignature"]))
# #print("i[From] ",i["From"], len(i["From"]))

# print(type(signMsg))
# print(signMsg)

# myVerifyer = Verifyer(n,e)

# print(myVerifyer.Verify(signMsg,"klavyefl@gmail.com"))


# # Sign the message using the PKCS#1 v1.5 signature scheme (RSASP1)
# # msg = b'anan'
# # hash = SHA256.new(msg)
# # signer = PKCS115_SigScheme(rsa_key) #RSA anahtarı ile imzalama
# # signature = signer.sign(hash)
# # #print("Signature:", binascii.hexlify(signature))

# # # Verify valid PKCS#1 v1.5 signature (RSAVP1)
# # msg = b'anan'
# # hash = SHA256.new(msg)
# # verifier = PKCS115_SigScheme(pubKey2) #Rsa public anahtarı
# # try:
# #     verifier.verify(hash, signature) 
# #     print("Signature is valid.")
# # except:
# #     print("Signature is invalid.")


# #Public key (e,n)
# #Private key (d,n)
# #Generate 2048-bit RSA key pair (private + public key)
# #keyPair = RSA.generate(bits=2048,e=65537)
# #pubKey = keyPair.publickey()
# #print(f"Public key:  (n={hex(keyPair.n)}, e={hex(keyPair.e)})")
# #print(f"Private key: (n={hex(keyPair.n)}, d={hex(keyPair.d)})")
# #print(f"Public key:  (n={keyPair.n}, e={keyPair.e})")
# #print(f"Private key: (n={keyPair.n}, d={keyPair.d})") 